"use client";

import { AlertCircle } from "lucide-react";
import {
  Frame,
  FrameDescription,
  FrameHeader,
  FramePanel,
  FrameTitle,
} from "@/components/ui/frame";
import { calculateMissingMeetings } from "@/lib/helpers/meeting-analytics";
import type { MeetingLog, Phase, Sprint } from "@/lib/types";

type MissingMeetingsCardProps = {
  logs: MeetingLog[];
  sprints: Sprint[];
  phases: Phase[];
};

/**
 * MissingMeetingsCard Component
 *
 * Displays the count of valid sprints/phases that do NOT have documented meetings
 * This helps identify documentation gaps that need attention
 *
 * @param logs - Array of all meeting logs
 * @param sprints - Array of all sprints
 * @param phases - Array of all phases
 */
export default function MissingMeetingsCard({
  logs,
  sprints,
  phases,
}: MissingMeetingsCardProps) {
  const missing = calculateMissingMeetings(logs, sprints, phases);

  const isAlert = missing.count > 0;

  return (
    <Frame>
      <FrameHeader className="flex-row items-center gap-2">
        <div
          className={`rounded-md p-2 shadow-sm ${
            isAlert
              ? "bg-linear-120 from-red-500 to-red-400 dark:from-red-800 dark:to-red-700"
              : "bg-linear-120 from-gray-500 to-gray-400 dark:from-gray-800 dark:to-gray-700"
          }`}
        >
          <AlertCircle className="size-4 text-white" />
        </div>
        <div className="space-y-0">
          <FrameTitle className="text-sm">Missing</FrameTitle>
          <FrameDescription className="text-xs">Meetings</FrameDescription>
        </div>
      </FrameHeader>
      <FramePanel>
        <div className="flex items-end gap-2">
          <p className="font-bold font-sora text-3xl">{missing.count}</p>
          <p className="grid text-muted-foreground text-xs">
            <span>
              {missing.sprints.length > 0 && (
                <>
                  {missing.sprints.length} sprint
                  {missing.sprints.length !== 1 ? "s" : ""}
                  {missing.phases.length > 0 && " and "}
                </>
              )}
            </span>
            <span>
              {missing.phases.length > 0 && (
                <>
                  {missing.phases.length} phase
                  {missing.phases.length !== 1 ? "s" : ""}
                </>
              )}
            </span>
            <span>{missing.count > 0 && " without meetings"}</span>
          </p>
        </div>
      </FramePanel>
    </Frame>
  );
}
